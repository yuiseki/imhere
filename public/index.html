<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>#imhere by yuiseki</title>
    <meta name="description" content="imhere">

    <!-- favicon -->
    <link rel="shortcut icon" type="image/png" href="/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="/map_family_shinken.png">

    <!-- PWA -->
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="imhere">

    <!-- Firebase関連jsの読み込み -->
    <!-- TODO: firebaseのバージョン上がったら書き換える -->
    <script defer src="/__/firebase/7.14.2/firebase-app.js"></script>
    <script defer src="/__/firebase/7.14.2/firebase-auth.js"></script>
    <script defer src="/__/firebase/7.14.2/firebase-firestore.js"></script>
    <script defer src="/__/firebase/7.14.2/firebase-messaging.js"></script>
    <script defer src="/__/firebase/7.14.2/firebase-storage.js"></script>
    <script defer src="/__/firebase/init.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <!-- css -->
    <style>
      html {
        font-size: 10px;
      }
      div#categories {
        font-size: 2em;
        margin: 15px;
      }
      @media (min-width: 576px){
        .card-columns {
          column-count: 6;
        }
      }
      div.card {
        width: 9rem;
      }
      div.card img {
        width: 100%;
        height: auto;
      }
    </style>

  </head>
  <body>
    <div class="jumbotron">
      <h1>#imhere by yuiseki</h1>
      <h2>あらゆるマイノリティの可視化を目標としているプラットフォームです</h2>
      <h2>Twitterアカウントでログインして自分のような属性の人間が存在していることを世界にアピールできます</h2>
      <div id="wrap">
        <a class="twitter-login-button" data-size="large" href="/home.html"><img src="https://cdn.cms-twdigitalassets.com/content/dam/developer-twitter/icons/sign-in-with-twitter-gray-1-png-img-fullhd-medium.png.img.fullhd.medium.png" /></a>
      </div>
    </div>
    <div id="categories" class="card-columns">
    </div>
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        try {
          let app = firebase.app();
          let features = ['auth', 'firestore', 'messaging', 'storage'].filter(feature => typeof app[feature] === 'function');
          var db = firebase.firestore();
          db.collection("categories").orderBy("name").get().then((query)=>{
            query.forEach((cat)=>{
              catdata = cat.data();
              // wrap
              cardwrap = document.createElement("div");
              cardwrap.setAttribute("class", "card")
              // header
              cardheader = document.createElement("div");
              cardheader.setAttribute("class", "card-header");
              if (catdata.users){
                cardheader.innerHTML = catdata.name+"<b> ("+catdata.users.length+")</b>";
              }else{
                cardheader.innerHTML = catdata.name;
              }
              cardwrap.appendChild(cardheader);
              // image
              if (catdata.image_url){
                cardimg = document.createElement("img");
                cardimg.setAttribute("class", "card-img-top");
                cardimg.setAttribute("src", catdata.image_url);
                cardwrap.appendChild(cardimg);
              }
              //cardbody = document.createElement("div");
              //cardbody.setAttribute("class", "card-body")
              document.getElementById("categories").appendChild(cardwrap);
            })
          })

        } catch (e) {
          console.error(e);
        }
      });
    </script>
  </body>
</html>
